{% extends 'desings/baseDashboard.html.twig' %}
{# José Hernández email: jghernandez053@gmail.com #}
{% block contentDashboard %}
    <div class="row">
        <!--Pantalla oculta para seleccionar tipo de opciones-->
        <div class="msg_sel" id="msg01">
                <div id="message_sel">
                    <h4 class="_orange" style="text-align:left"><span class="glyphicon glyphicon-list-alt" style="margin-right:10px;"></span>SELECCION</h4>
                    <hr class="line_style" />
                    <p style="text-align:left" class="af-text-win-select" >Se ha seleccionado el siguiente dato:</p>
                    <label id="msg1"></label>
                    <label id="msg2"></label>
                    <p style="text-align:left;" class="af-text-win-select">¿Que desea realizar?
                    </p>
                    <a  href="#" id="queryWin" class="btn btn-ttc">
                        <span class="glyphicon glyphicon-edit" style="margin-right:10px;"></span>Consultar
                    </a>
                    <a href="javascript://salir ;" id="outwin" class="btn btn-ttc">
                        <span class="glyphicon glyphicon-log-out" style="margin-right:10px;"></span>Salir
                    </a>
                </div>
        </div>
        <!-- Fin Pantalla oculta para seleccionar tipo de opciones-->
        <div class="col-lg-10">
            <div class="row">
                <div class="col-lg-6 left title_modify">
                        <h3 class="af-title-h3">CONSULTAR ACTIVO FIJO</h3>
                        <h4><small>Puede emplear los diferentes tipos de filtro para encontrar el activo fijo.</small> </h4>
                </div>
                <div class="col-lg-6 text-right" style="margin-bottom:12px;" >
                </div>
            </div>
            <hr class="line-style-top-table" />
            <div class="row ventana1 form-inline">
                <div class="col-md-4 form-group">
                    <label for="selPropiedad" class="requerid">Propiedad:</label>
                    <select id="selPropiedad" class="form-control">
                    </select>
                </div>
                <div class="col-md-4 form-group">
                    <label for="selUbicacion" class="requerid">Ubicación:</label>
                    <select id="selUbicacion" class="form-control">
                    </select>
                </div>
                <div class="col-md-4 form-group">
                    <label for="selClase" class="requerid">Clasificación:</label>
                    <select id="selClase" class="form-control">
                    </select>
                </div>
            </div>
            <div class="row ventana1 form-inline">
                <div class="col-md-4 form-group">
                    <label for="selEstatus">Filtrar Por Estatus</label>
                    <select name="selEstatus" id="selEstatus" class="form-control">
                        <option value="todos">Todos</option>
                        <option value="activo">Activo</option>
                        <option value="finiquito">Finiquito</option>
                        <option value="mejorado">Mejora</option>
                    </select>
                </div>
                <div class="col-md-4 form-group">
                    <label for="codeActivof">Código Activo Fijo:</label>
                    <input type="text" id="codeActivof" class="form-control" value="" onKeyDown="solo_texto(event)" placeholder="..." autocomplete="off" />
                </div>
                <div class="col-md-4 form-group text-right">
                    <div class="text-right" style="width:100%">
                        <a href="#" class="btn btn-dark" id="progQuery">Procesar Consulta</a>
                    </div>
                </div>
            </div>
            <table id="tblConsultaAF"  class="table table-striped table-hover text_table">
                <thead>
                    <tr>
                        <th style="width:10%">ID</th>
                        <th style="width:20%">DESCRIPCION</th>
                        <th style="width:10%">FECHA</th>
                        <th style="width:15%">SERIAL</th>
                        <th style="width:10%">CLASE DE ACTIVO</th>
                        <th style="width:15%">CÓDIGO ASIGNADO</th>
                        <th style="width:10%">COSTO ACTUAL</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            <div class="row mb-4">
                <div class="col-lg-12 text-center">
                    <a  href="{{ path('app_default') }}" class="btn btn-dark">Retornar</a>
                </div>
            </div>

        </div>
        <div class="col-lg-2">
                <h4 class="_orange">FILTRO PROPIEDAD:</h4>
                <hr class="line_style" />
                <p class="af-p-12">Deberá seleccionar la propiedad para que pueda actualiza lista desplegable de ubicaciones.</p>
                <br>
                <h4 class="_orange">FILTRO UBICACIÓN:</h4>
                <hr class="line_style" />
                <p class="af-p-12">Seleccione la ubicación desde la lista desplegable para que se pueda ingresar activos fijos.</p>
                <br>
                <h4 class="_orange">LISTADO:</h4>
                <hr class="line_style" />
                <p class="af-p-12">Seleccione el activo que desea finiquitar  y pulse la opción correspondiente a Finiquito.</p>

        </div>
    </div>
{% endblock %}

{% block javascriptsFooter %}

<script type="text/javascript">
    var tblConsultaAF=null;
    var idCode = "";
    var idPropiedad="todos";
    var idUbicacion="todos";
    var idClase = "todos";
    var CodeActivof = "";
    var Estatus="todos";

    $(document).ready(function(e){
        //loadLstConsulta();
        $(document).on("click",".tr-select",function(event){
            //console.log("Seleccionado:" + $(this).attr("id"));
            idCode = String($(this).attr("id"));
            var idNombre = "#name_" + String($(this).attr("id"));
            var Nombre = $(idNombre).val();

            var rutaEdit = "{{ path('info_consulta',{idActivo:'invertCode'}) }}";

            rutaEdit = rutaEdit.replace('invertCode',idCode);

            $("#queryWin").attr("href",rutaEdit);

            $("#msg1").empty();
            $("#msg2").empty();
            $("#msg1").html("<b>Id:</b>"+idCode);
            $("#msg2").html("<b>Descrip:</b>"+Nombre);

            $("#msg01").fadeIn('slow',function(e){
                $("#msg01").css("display","inherit");
            });
        });

        $("#outwin").click(function(e){
            e.preventDefault();
            $("#msg01").fadeOut('slow',function(e){
                $("#msg01").css("display","none");
            })
        });

        var rootSelClase="{{ path('ajax_sel_clase') }}";

        $.ajax({
            data:{},
            method:'post',
            dataType:'json',
            url:rootSelClase,
            error:function(err,txt,thr){
                $('body').empty();
                $('body').html(err.responseText);
            },
            success:function(result){
                if (result.ok=='01'){
                    var idClase = 'todos';
                    var htmlCode = '';
                    $.each(result.elements,function(posc,item){
                        if (idClase==item.id){
                            htmlCode+='<option value="'+item.id+'" selected>'+item.data+'</option>\n';
                        } else {
                            htmlCode+='<option value="'+item.id+'">'+item.data+'</option>\n';
                        }
                    });
                    $("#selClase").empty();
                    $("#selClase").append(htmlCode);
                    //loadLstConsulta();
                    $("#selClase").change();
                } else {
                    console.log(result.msg);
                }
            }
        });
        var rootSelProp="{{ path('ajax_sel_prop') }}";

        $.ajax({
            data:{},
            method:'post',
            dataType:'json',
            url:rootSelProp,
            error:function(err,txt,thr){
                $('body').empty();
                $('body').html(err.responseText);
            },
            success:function(result){
                if (result.ok=='01'){
                    var idProp = 'todos';
                    var htmlCode = '';
                    $.each(result.elements,function(posc,item){
                        if (item.id=="select"){
                            htmlCode+='<option value="todos" selected>Todos</option>\n';
                        } else {
                            htmlCode+='<option value="'+item.id+'">'+item.data+'</option>\n';
                        }
                    });
                    $("#selPropiedad").empty();
                    $("#selPropiedad").append(htmlCode);
                    //loadLstConsulta();
                    $("#selPropiedad").change();
                } else {
                    console.log(result.msg);
                }
            }
        });
        $("#selClase").change(function(e){
            idClase = $(this).val();
        });
        $("#selEstatus").change(function(e){
            Estatus = $(this).val();
        });

        $("#selPropiedad").change(function(e){
            idPropiedad = $(this).val();
            selectUbicacion(idPropiedad);

        });
        $("#selUbicacion").change(function(e){
            idUbicacion = $(this).val();
            //loadLstConsulta();
        });
        $("#codeActivof").change(function(e){
            CodeActivof = $(this).val();
            //loadLstConsulta();
        });

        $(document).on("click",".selActive",function(event){
            //event.preventDefault();
            var idCode = $(this).data('id');
            var rootAjax = "{{ path('mark_identificar') }}";

            //console.log("idcode "+idCode);
            var condi="not";
            if ($(this).is(":checked"))
            {
                condi="yes";
            } else {
                condi="not";
            }
            $.ajax({
                data:{'condi':condi,'idCode':idCode},
                type:'post',
                dataType:'json',
                url:rootAjax,
                error:function(err,txt,thr){
                    $('body').empty();
                    $('body').html(err.responseText);
                },
                success: function(result){
                    if (result.ok=='01'){
                        /*
                        if (result.refresh=='yes'){
                            loadLstConsulta();
                        }*/
                    } else {
                        console.log(result.msg);
                        event.preventDefault();
                    }                    
                }
            });

        });
        $("#progQuery").click(function(event){
            event.preventDefault();
            loadLstConsulta();
        });

    }); // Fin de Document Ready

    function selectUbicacion(idProp){
        var rootSelUbic="{{ path('ajax_sel_ubic') }}";

        $.ajax({
            data:{'idProp':idProp},
            method:'post',
            dataType:'json',
            url:rootSelUbic,
            error:function(err,txt,thr){
                $('body').empty();
                $('body').html(err.responseText);
            },
            success:function(result){
                if (result.ok=='01'){
                    var idUbic = 'todos';
                    var htmlCode = '';
                    $.each(result.elements,function(posc,item){
                        if ("select"==item.id){
                            htmlCode+='<option value="todos" selected>Todos</option>\n';
                        } else {
                            htmlCode+='<option value="'+item.id+'">'+item.data+'</option>\n';
                        }
                    });
                    $("#selUbicacion").empty();
                    $("#selUbicacion").append(htmlCode);
                    //loadLstConsulta();
                    $("#selUbicacion").change();
                } else {
                    console.log(result.msg);
                }
            }
        });

    }


    function loadLstConsulta(){
        var rootAjaxList = "{{ path('ajax_lstConsulta') }}";

        CodeActivof = String($("#codeActivof").val());

        tblConsultaAF = $('#tblConsultaAF').dataTable({
                destroy:true,
                serverSide: true,
                searching: false,
                lengthChange: false,
                pageLength:5,
                language:{
                    info:"Mostrando  _END_/_TOTAL_ ",
                    infoEmpty:"No se tiene datos", 
                    paginate:{
                        first:"Primero",
                        previous:"Previo",
                        next:"Próximo",
                        last:"Último"
                    }
                },
                dom: '<"btnSearch">Pfrtip',
                ajax:{
                    data:{'idPropiedad':idPropiedad, 'idUbicacion':idUbicacion,'idClase':idClase,'CodeActivof':CodeActivof,'Estatus':Estatus},
                    method:"POST",
                    dataType:"JSON",
                    url:rootAjaxList,
                    error: function(err,txt,thr){
                        $("body").empty();
                        $("body").html(err.responseText);
                    }
                },
                autoWidth:false,
                columnDefs:[
                    {'width':'10%'},
                    {'width':'20%'},
                    {'width':'10%'},
                    {'width':'15%'},
                    {'width':'10%'},
                    {'width':'15%'},
                    {'width':'10%'},
                ],
                columns:[
                    {data:"id"},
                    {data:"descrip"},
                    {data:"fechac"},
                    {data:"numserie"},
                    {data:"clase"},
                    {data:"code"},
                    {data:"estatus"},

                ],
                deferRender: true
        });
        //$("div.btnSearch").html('<button type="button" class="btn btn-dark" id="SearchData"><i class="fa fa-search"></i></button>');	            
    }
</script>
{% endblock %}
