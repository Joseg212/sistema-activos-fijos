{% extends 'desings/baseDashboard.html.twig' %}
{# José Hernández email: jghernandez053@gmail.com #}
{% block contentDashboard %}
{{ form_start(form,{'attr':{'role':'form','novalidate':'novalidate','class':'form-inline'}}) }}
<div class="row ml-2">
    <div class="modal-sel-win" id="selectResp">
        <div class="box-sel-win"> 
            <div class="row x-title">
                <h5 class="af-title-h5 text-center">Seleccionar Responsable</h5>
                <div class="col-md-12">
                    <table id="tblSelResp"  class="table table-striped table-hover text_table" style="width:100%">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>NOMBRES</th>
                                <th>APELLIDOS</th>
                                <th>CARGO</th>
                                <th>TELEFONO</th>
                                <th>MOVIL</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
                <div class="col-md-12 text-center">
                    <a href="#" id="exitWin" class="btn btn-dark">Retornar</a>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-10 af-content-data ventana1">
        <div class="row x_title">
            <div class="col-lg-12">
                <h3 class="af-title-h3">INGRESAR REPARACION</h3>
                <h4><small>Ingrese la información de la factura por concepto de reparación de un activo fijo.</small> </h4>
            </div>
        </div>
        <!--Informacion -->
        <div class="row box-af-style1">
            <div class="row">
                <div class="col-md-6 form-group">
                    <p><b>Activo Fijo:</b>{{ datosAF.descrip}}</p>
                </div>
                <div class="col-md-6 form-group">
                    <p><b>Fecha de Compra:</b>{{ datosAF.fechac }}</p>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 form-group">
                    <p><b>Número de Serie:</b> {{ datosAF.num_serie }}</p>
                </div>
                <div class="col-md-6 form-group">
                    <p><b>Estado del Activo:</b> {{ datosAF.edofisico }} </p>
                </div>
            </div>
        </div>
        <!-- Datos -->
        <div class="row box-af-style1" >
            <h5 class="af-title-h5 text-center">RESPONSABLE DEL ACTIVO</h5>
            <div class="row">
                <div class="col-md-6 form-group">
                    {{ form_label(form.id_af) }}
                    {{ form_widget(form.id_af,{'attr':{'value':idActivo}}) }}
                </div>
                <div class="col-md-6">
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 form-group">
                    {{ form_label(form.id_resp) }}
                    {{ form_widget(form.id_resp) }}
                    <input type="text" placeholder="..." id="nameResp" disabled class="form-control" vale="" autocomplete="off" />
                    <a href="#" id="idSearchResp" class="btn btn-secondary btn-search-form">BUSCAR  <i class="fa fa-search"></i></a>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4 form-group">
                    <label for="dat01Orig">Cargo:</label>
                    <input type="text" id="dat01" placeholder="..." disabled class="form-control" autocomplete="off" value="" />
                </div>
                <div class="col-md-4 form-group">
                    <label for="dat02Orig">Teléfono:</label>
                    <input type="text" id="dat02" placeholder="..." disabled class="form-control" autocomplete="off" value="" />
                </div>
                <div class="col-md-4 form-group">
                    <label for="dat03Orig">Móvil:</label>
                    <input type="text" id="dat03" placeholder="..." disabled class="form-control" autocomplete="off" value="" />
                </div>
            </div>
        </div>
        <div class="row box-af-style1" >
            <h5 class="af-title-h5 text-center">INFORMACION DE LA FACTURA</h5>
            <div class="row">
                <div class="col-md-8 form-group">
                    {{ form_label(form.proveedor) }}
                    {{ form_widget(form.proveedor) }}
                </div>
                <div class="col-md-4 form-group">
                    {{ form_label(form.proveedor_rif) }}
                    {{ form_widget(form.proveedor_rif) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-4 form-group">
                    {{ form_label(form.fecha_fact) }}
                    {{ form_widget(form.fecha_fact) }}
                </div>
                <div class="col-md-4 form-group">
                    {{ form_label(form.nro_fact) }}
                    {{ form_widget(form.nro_fact) }}
                </div>
                <div class="col-md-4 form-group">
                    {{ form_label(form.telefono_prov) }}
                    {{ form_widget(form.telefono_prov) }}
                </div>
            </div>
            <hr style="width:100%"> 
            <div class="row">
                <div class="col-md-4 form-group">
                    {{ form_label(form.monto_fact) }}
                    {{ form_widget(form.monto_fact,{attr:{'value':'0.00'}}) }}
                </div>
                <div class="col-md-4 form-group">
                    {{ form_label(form.monto_iva) }}
                    {{ form_widget(form.monto_iva,{attr:{'value':'0.00'}}) }}
                </div>
                <div class="col-md-4 form-group">
                    {{ form_label(form.total_factura) }}
                    {{ form_widget(form.total_factura,{attr:{'value':'0.00'}}) }}
                </div>
            </div>
            <hr style="width:100%"> 
            <div class="row">
                <div class="col-md-4 form-group">
                    <p class="af-p-12 af-p-info">Indique el tiempo empleado para la reparación del activo.</p>
                </div>
                <div class="col-md-4 form-group">
                    {{ form_label(form.unidad_tiempo) }}
                    {{ form_widget(form.unidad_tiempo) }}
                </div>
                <div class="col-md-4 form-group">
                    {{ form_label(form.numero_tiempo) }}
                    {{ form_widget(form.numero_tiempo) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-4 form-group">
                    {{ form_label(form.banco) }}
                    {{ form_widget(form.banco) }}
                </div>
                <div class="col-md-4 form-group">
                    {{ form_label(form.tipo_doc) }}
                    {{ form_widget(form.tipo_doc) }}
                </div>
                <div class="col-md-4 form-group">
                    {{ form_label(form.numero_doc) }}
                    {{ form_widget(form.numero_doc) }}
                </div>
            </div>
        </div>
        <div class="row box-af-style1" >
            <h5 class="af-title-h5 text-center">DATOS ADICIONALES</h5>
            <div class="row">
                <div class="col-md-12 form-group">
                    {{ form_label(form.detalle) }}
                    {{ form_widget(form.detalle) }}
                </div>
            </div>
            <div class="row">
                <div class="col-md-4 form-group">
                    {{ form_label(form.si_traslado) }}
                    {{ form_widget(form.si_traslado) }}
                </div>
                <div class="col-md-8 form-group">
                    <p class="af-p-12 af-p-info">En caso de haberse cobrado flete para la reparación del activo active la casilla "Incluir costo de flete".</p>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4 form-group">
                    {{ form_label(form.costo_traslado) }}
                    {{ form_widget(form.costo_traslado,{attr:{'value':'0.00'}}) }}
                </div>
                <div class="col-md-4 form-group">
                    {{ form_label(form.imp_traslado) }}
                    {{ form_widget(form.imp_traslado,{attr:{'value':'0.00'}}) }}
                </div>
                <div class="col-md-4 form-group">
                    {{ form_label(form.total_traslado) }}
                    {{ form_widget(form.total_traslado,{attr:{'value':'0.00'}}) }}
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <span class="text-danger">{{ form_errors(form.id_af) }}</span>
                <span class="text-danger">{{ form_errors(form.id_resp) }}</span> 
                <span class="text-danger">{{ form_errors(form.fecha_fact) }}</span> 
                <span class="text-danger">{{ form_errors(form.proveedor) }}</span> 
                <span class="text-danger">{{ form_errors(form.proveedor_rif) }}</span> 
                <span class="text-danger">{{ form_errors(form.nro_fact) }}</span> 
                <span class="text-danger">{{ form_errors(form.monto_fact) }}</span> 
                <span class="text-danger">{{ form_errors(form.numero_tiempo) }}</span> 
                <span class="text-danger">{{ form_errors(form.detalle) }}</span> 

            </div>
        </div>
        <!-- Botones -->
        <div class="row mt-4" style="clear:left">
            <div class="col-md-12">
                <div class="form-group" style="float:right;clear:right;"> 
                    {{ form_widget(form.write) }}
                    <a href="{{path('app_reparacion',{'idActivo':idActivo})}}" class="btn btn-dark">Retornar</a>
                </div>
            </div>
        </div>
        <!-- Botones -->
    </div>
    <div class="col-md-2">
        <h4 class="_orange">INFORMACION:</h4>
        <hr class="line_style" />
        <p class="af-p-12">Ingrese los datos solicitado, para culminar y guardar la información hacer clic en el Guardar</p>
    </div>
</div>
{{ form_end(form) }}

{% endblock %}

{% block javascriptsFooter %}

<script type="text/javascript">
    var tipoRespSel = 0;
    $(document).ready(function(e){
        // Responsable
        $("#idSearchResp").click(function(event){
            event.preventDefault();
            loadLstSelResp();

            $("#selectResp").fadeIn("slow",function(e){
                $("#selectResp").css("display","inherit");
            });

        });
        // Salir de la ventana de Seleccion 
        $("#exitWin").click(function(event){
            event.preventDefault();
            tipoRespSel = 0;
            $("#selectResp").fadeOut("slow",function(e){
                $("#selectResp").css("display","none");
            });
        });
        // Seleccion de Responsable 
        $(document).on("click",".tr-select",function(event){
            //console.log("Seleccionado:" + $(this).attr("id"));
            idCode = String($(this).attr("id"));
            var idNombre = "#name_" + String($(this).attr("id"));
            var Nombre = $(idNombre).val();

            var OtroDatos = String($("#cadena_"+idCode).val());
            var arrOtroDatos = OtroDatos.split('/');

            $("#mantenimiento_id_resp").val(idCode);
            $("#nameResp").val(Nombre);

            $("#dat01").val(arrOtroDatos[0]);
            $("#dat02").val(arrOtroDatos[1]);
            $("#dat03").val(arrOtroDatos[2]);

            $("#selectResp").fadeOut("slow",function(e){
                $("#selectResp").css("display","none");
            });

        });

        $("#mantenimiento_monto_fact").change(function(e){
            var monto = parseFloat(String($(this).val()).replace(',',''));                
            var impuesto = parseFloat(String($("#mantenimiento_monto_iva").val()).replace(',',''));

            var total = (monto+impuesto).toFixed(2);

            $("#mantenimiento_total_factura").val(total);

        })
        $("#mantenimiento_monto_iva").change(function(e){
            var impuesto = parseFloat(String($(this).val()).replace(',',''));                
            var monto = parseFloat(String($("#mantenimiento_monto_fact").val()).replace(',',''));
            var total = (monto+impuesto).toFixed(2);
            $("#mantenimiento_total_factura").val(total);
        })

        $("#mantenimiento_si_traslado").change(function(event){
            if ($(this).is(":checked"))
            {
                $("#mantenimiento_costo_traslado").removeAttr("readonly");
                $("#mantenimiento_imp_traslado").removeAttr("readonly");
            } else {
                $("#mantenimiento_costo_traslado").attr("readonly",true);
                $("#mantenimiento_imp_traslado").attr("readonly",true);
                $("#mantenimiento_costo_traslado").val("0.00");
                $("#mantenimiento_imp_traslado").val("0.00");
                $("#mantenimiento_total_traslado").val("0.00");
            }
        });

        if ($("#mantenimiento_si_traslado").is(":checked"))
        {
            $("#mantenimiento_costo_traslado").removeAttr("readonly");
            $("#mantenimiento_imp_traslado").removeAttr("readonly");
        } else {
            $("#mantenimiento_costo_traslado").attr("readonly",true);
            $("#mantenimiento_imp_traslado").attr("readonly",true);
        }

        $("#mantenimiento_costo_traslado").change(function(e){
            var monto = parseFloat(String($(this).val()).replace(',',''));                
            var impuesto = parseFloat(String($("#mantenimiento_imp_traslado").val()).replace(',',''));

            var total = (monto+impuesto).toFixed(2);

            $("#mantenimiento_total_traslado").val(total);

        });
        $("#mantenimiento_imp_traslado").change(function(e){
            var impuesto = parseFloat(String($(this).val()).replace(',',''));                
            var monto = parseFloat(String($("#mantenimiento_costo_traslado").val()).replace(',',''));
            var total = (monto+impuesto).toFixed(2);
            $("#mantenimiento_total_traslado").val(total);
        });

    }); // Fin Document Ready 


    // La lista de seleccion de responsable
    function loadLstSelResp(){
        console.log("Carga la lista...");

        var rootAjaxList = "{{ path('ajax_lstResponsable') }}";

        tblSelResp = $('#tblSelResp').dataTable({
                destroy:true,
                serverSide: true,
                searching: true,
                lengthChange: false,
                pageLength:8,
                language:{
                    info:"Mostrando  _END_/_TOTAL_ ",
                    infoEmpty:"Mostrando  1 de 0 ", 
                    paginate:{
                        first:"Primero",
                        previous:"Previo",
                        next:"Próximo",
                        last:"Último"
                    }
                },
                dom: '<"btnSearch">Pfrtip',
                ajax:{
                    method:"POST",
                    dataType:"JSON",
                    url:rootAjaxList,
                    error: function(err,txt,thr){
                        $("body").empty();
                        $("body").html(err.responseText);
                    }
                },
                columns:[
                    {data:"id"},
                    {data:"nombre"},
                    {data:"apellido"},
                    {data:"cargo"},
                    {data:"telefono"},
                    {data:"movil"},
                ],
                deferRender: true
        });

        $("div.btnSearch").html('<button type="button" class="btn btn-dark" id="SearchData"><i class="fa fa-search"></i></button>');	            
    }


</script>
<style> 
    @media (min-width:576px)  {
        .form-inline .form-control {
            width: none !important;
        }
    }
</style>
{% endblock %}
